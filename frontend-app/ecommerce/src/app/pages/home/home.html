<div class="dashboard-container">
  <div class="header">
    <h1>ğŸ“Š Dashboard E-Commerce</h1>
    <button class="btn btn-refresh" (click)="refresh()" [disabled]="loading()">
      {{ loading() ? 'ğŸ”„ Loading...' : 'ğŸ”„ Refresh' }}
    </button>
  </div>

  <div class="connection-status" [class.error]="connectionStatus().includes('Error')">
    <h3 id="msg">{{ connectionStatus() }}</h3>
  </div>

  @if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading dashboard data...</p>
    </div>
  }

  @if (error() && !loading()) {
    <div class="error-message">
      <p>âŒ {{ error() }}</p>
      <button class="btn btn-primary" (click)="loadStats()">Retry</button>
    </div>
  }

  @if (stats() && !loading()) {
    <div class="stats-grid">
      <app-stats-card
        title="Total Logs"
        [value]="stats()!.totalLogs"
        subtitle="All time logs indexed"
        icon="ğŸ“"
        color="primary">
      </app-stats-card>

      <app-stats-card
        title="Logs Today"
        [value]="stats()!.logsToday"
        subtitle="Logs received today"
        icon="ğŸ“…"
        color="success">
      </app-stats-card>

      <app-stats-card
        title="Errors"
        [value]="stats()!.errorCount"
        subtitle="Error logs detected"
        icon="âš ï¸"
        color="danger">
      </app-stats-card>

      <app-stats-card
        title="Files Uploaded"
        [value]="stats()!.filesUploaded"
        subtitle="Total files processed"
        icon="ğŸ“"
        color="warning">
      </app-stats-card>
    </div>

    <div class="charts-section">
      <div class="kibana-dashboard-card">
        <div class="dashboard-header">
          <h3>ğŸ“Š Kibana Analytics Dashboard</h3>
          <a [href]="'http://localhost:5601/app/dashboards#/view/baed2430-d360-11f0-8cc1-e14176d70d6e'" 
             target="_blank" 
             class="btn btn-sm btn-secondary">
            Open in Kibana â†—
          </a>
        </div>
        <div class="kibana-iframe-container">
          <iframe 
            [src]="kibanaDashboardUrl"
            frameborder="0"
            class="kibana-iframe">
          </iframe>
        </div>
      </div>
    </div>

    <div class="metrics-section">
      <div class="metric-card">
        <h4>Conversion Rate</h4>
        <p class="metric-value">{{ stats()!.conversionRate }}%</p>
      </div>

      <div class="metric-card">
        <h4>Avg Transaction Amount</h4>
        <p class="metric-value">${{ stats()!.averageTransactionAmount }}</p>
      </div>
    </div>

    <div class="quick-actions">
      <h3>Quick Actions</h3>
      <div class="action-buttons">
        <a routerLink="/upload" class="action-btn">
          <span class="action-icon">ğŸ“¤</span>
          <span>Upload Logs</span>
        </a>
        <a routerLink="/search" class="action-btn">
          <span class="action-icon">ğŸ”</span>
          <span>Search Logs</span>
        </a>
        <a routerLink="/files" class="action-btn">
          <span class="action-icon">ğŸ“‹</span>
          <span>View Files</span>
        </a>
      </div>
    </div>
  }

  @if (!stats() && !loading() && !error()) {
    <div class="no-backend">
      <div class="no-backend-icon">ğŸ”Œ</div>
      <h3>Backend Not Connected</h3>
      <p>The application frontend is ready, but the backend API is not available.</p>
      <p>You can explore the interface using the navigation menu.</p>
      <div class="action-buttons">
        <a routerLink="/upload" class="btn btn-primary">
          ğŸ“¤ Upload Page
        </a>
        <a routerLink="/search" class="btn btn-primary">
          ğŸ” Search Page
        </a>
        <a routerLink="/files" class="btn btn-primary">
          ğŸ“‹ Files Page
        </a>
      </div>
    </div>
  }
</div>
